<!DOCTYPE html>
<html ng-app="app">

  <head>
    <meta charset="utf-8">
    <title>User Management</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js" charset="utf-8"></script>
   <!-- <script src="js/fetch.js" charset="utf-8"></script> -->

  </head>


  <body ng-controller='MainCtrl' class="container">

    <div class="row form-section">
      <div class="col-md-12">
        <div class="create_update">

        
        <form class="form" id="CREATE_USER">
          <div class="form row">
            <h3 class="crud_title">Create user</h3>
            <div class="form-group col-md-3">
              <label>userId</label>
              <input type="text" class="form-control" name="userId" id="CREATE_userId"/>
            </div>
            <div class="form-group col-md-6">
              <label>firstName</label>
              <input type="text" class="form-control" name="firstName" id="CREATE_firstName"/>
            </div>
            <div class="form-group col-md-6">
              <label>lastName</label>
              <input type="text" class="form-control" name="lastName" id="CREATE_lastName"/>
            </div>
            <div class="form-group col-md-6">
              <label>username</label>
              <input type="text" class="form-control" name="username" id="CREATE_username"/>
            </div>
          </div>
        <button class="btn btn-success" type="submit">Create</button>
      </form>
      
        <form class="form" id="UPDATE_USER">
          <div class="form row">
            <h3 class="crud_title">Update user</h3>
            <div class="form-group col-md-3">
              <label>userId</label>
              <input type="text" class="form-control" name="userId" id="UPDATE_userId"/>
            </div>
            <div class="form-group col-md-6">
              <label>firstName</label>
              <input type="text" class="form-control" name="firstName" id="UPDATE_firstName"/>
            </div>
            <div class="form-group col-md-6">
              <label>lastName</label>
              <input type="text" class="form-control" name="lastName" id="UPDATE_lastName"/>
            </div>
            <div class="form-group col-md-6">
              <label>username</label>
              <input type="text" class="form-control" name="username" id="UPDATE_username"/>
            </div>
          </div>
        <button class="btn btn-success" type="submit">Update</button>
      </form>
    </div>

<hr>
        <form class="form" id="READ_USER">
          <h3 class="crud_title">Search by ID</h3>
          <div class="form-group col-md-6">
              <label>userId</label>
              <input type="text" class="form-control" name="userId" id="READ_userId"/>
          </div>
          <button class="btn btn-success" type="submit">Search</button>
          <button class="btn btn-success" id="RELOAD">Reload</button>
        <div>
          <p>First name: </p>
          <p>Last name: </p>
          <p>Username: </p>
        </div>
      </form>


<hr>
 
        <form class="form" id="DELETE_USER">
          <h3 class="crud_title">Delete by ID</h3>
          <div class="form-group col-md-6">
              <label>userId</label>
              <input type="text" class="form-control" name="userId" id="DELETE_userId"/>
          </div>
          <button class="btn btn-success" type="submit">Delete</button>
        </form>

<hr>

      </div>
      
    </div>


<script type="text/javascript">

  const linkAPI_POST = "https://mrh8oqh3li.execute-api.eu-central-1.amazonaws.com/prod/uploadeventtosqs/";
  const linkAPI_GET = "https://mrh8oqh3li.execute-api.eu-central-1.amazonaws.com/prod/getuser?userId=";

  //CREATE
  const createUser = document.getElementById('CREATE_USER');
  createUser.addEventListener('submit', function(e){
    e.preventDefault();

    fetch(linkAPI_POST, {
      mode: 'no-cors',
      method: "post",
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },

      body: JSON.stringify({
        "typeEvent": "C",
        "userId": document.getElementById('CREATE_userId').value.trim(),
        "firstName": document.getElementById('CREATE_firstName').value.trim(),
        "lastName": document.getElementById('CREATE_lastName').value.trim(),
        "username": document.getElementById('CREATE_username').value.trim()
      })
    });

    document.getElementById('CREATE_userId').value = "";
    document.getElementById('CREATE_firstName').value = "";
    document.getElementById('CREATE_lastName').value = "";
    document.getElementById('CREATE_username').value = "";
  });

  //READ
  /*const getUser = document.getElementById('READ_USER');
  getUser.addEventListener('submit', function(e){
    e.preventDefault();

    fetch(linkAPI_POST, {
      mode: 'no-cors',
      method: "post",
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },

      body: JSON.stringify({
        "typeEvent": "R",
        "userId": document.getElementById('READ_userId').value.trim()
      })
    }).then(response => response.json()).then(data => console.log(JSON.stringify(data)));

    document.getElementById('READ_userId').value = "";
  });*/

  //UPDATE
  const updateUser = document.getElementById('UPDATE_USER');
  updateUser.addEventListener('submit', function(e){
    e.preventDefault();

    fetch(linkAPI_POST, {
      mode: 'no-cors',
      method: "post",
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },

      body: JSON.stringify({
        "typeEvent": "U",
        "userId": document.getElementById('UPDATE_userId').value.trim(),
        "firstName": document.getElementById('UPDATE_firstName').value.trim(),
        "lastName": document.getElementById('UPDATE_lastName').value.trim(),
        "username": document.getElementById('UPDATE_username').value.trim()
      })
    });

    document.getElementById('UPDATE_userId').value = "";
    document.getElementById('UPDATE_firstName').value = "";
    document.getElementById('UPDATE_lastName').value = "";
    document.getElementById('UPDATE_username').value = "";
  });


  //DELETE
  const deleteUser = document.getElementById('DELETE_USER');
  deleteUser.addEventListener('submit', function(e){
    e.preventDefault();

    fetch(linkAPI_POST, {
      mode: 'no-cors',
      method: "post",
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },

      body: JSON.stringify({
        "typeEvent": "D",
        "userId": document.getElementById('DELETE_userId').value.trim()
      })
    });

    document.getElementById('DELETE_userId').value = "";
  });

  //RELOAD
  const reload = document.getElementById('RELOAD');
  reload.addEventListener('click', function(e){
    e.preventDefault();

    fetch(linkAPI_GET + document.getElementById('READ_userId').value.trim(), {
      method: "GET",
      headers: {
        'Content-Type': 'application/json'
      }
    }).then(function(response){
        const stringedResponse = JSON.stringify(response);
        const parsedResponse = JSON.parse(stringedResponse);
        console.log("RES: " + stringedResponse);
        console.log(response);
    });
  });
</script>


  </body>
</html>